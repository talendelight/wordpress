# Deployment Guide - Hostinger Git Integration

This guide covers deploying WordPress to Hostinger using their built-in Git integration feature. Development uses Docker/Podman locally, production runs on Hostinger's shared hosting.

## Deployment Architecture

**Development (Local Machine):**
- Docker/Podman containers via [infra/dev/compose.yml](../infra/dev/compose.yml)
- WordPress 6.9.0 + PHP 8.3 + MariaDB 11.8.3
- Ephemeral database (resets on `podman-compose down -v`)

**Production (Hostinger):**
- Traditional shared hosting (no containers)
- Hostinger-managed WordPress core
- Auto-deployment via Git integration
- Push to `main` branch triggers deployment

---

## Initial Setup

### Prerequisites

1. ‚úÖ Hostinger hosting account with WordPress plan
2. ‚úÖ Git repository (GitHub/GitLab/Bitbucket)
3. ‚úÖ WordPress installed on Hostinger (via hPanel one-click installer)
4. ‚úÖ Domain configured and SSL certificate active

### Step 1: Connect Repository to Hostinger

1. **Log in to Hostinger hPanel** (https://hpanel.hostinger.com)

2. **Navigate to Git Deployment:**
   - Websites ‚Üí Select your site ‚Üí Advanced ‚Üí Git

3. **Create New Deployment:**
   - Click "Create New Deployment"
   - Select Git provider (GitHub/GitLab/Bitbucket)
   - Authorize Hostinger to access your repositories
   - Select repository: `your-username/wordpress`
   - Select branch: `main`

4. **Configure Deployment Settings:**
   - **Branch:** `main`
   - **Deployment path:** `public_html`
   - **Auto-deploy:** ‚úÖ Enable (deploys automatically on push)
   - **Build command:** Leave empty (no build step needed)

5. **Save Configuration**

Hostinger will now:
- Monitor your `main` branch for changes
- Automatically deploy on every push
- Respect `.hostingerignore` exclusions

### Step 2: Understand Repository Structure

```
wordpress/                          # Repository root
‚îú‚îÄ‚îÄ wp-content/                     # ‚úÖ DEPLOYED to public_html/wp-content/
‚îÇ   ‚îú‚îÄ‚îÄ themes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blocksy/                # Your active theme
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ twentytwenty*/          # Default themes
‚îÇ   ‚îú‚îÄ‚îÄ plugins/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ your-custom-plugin/     # ‚úÖ Custom plugins (tracked)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ woocommerce/            # ‚ùå Optional: exclude from git
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ elementor/              # ‚ùå Optional: exclude from git
‚îÇ   ‚îú‚îÄ‚îÄ mu-plugins/                 # ‚úÖ Must-use plugins (if any)
‚îÇ   ‚îî‚îÄ‚îÄ uploads/                    # ‚ùå Excluded (.gitignore)
‚îÇ
‚îú‚îÄ‚îÄ .hostingerignore                # Deployment exclusions
‚îú‚îÄ‚îÄ .gitignore                      # Git tracking rules
‚îÇ
‚îú‚îÄ‚îÄ infra/                          # ‚ùå Dev only (not deployed)
‚îÇ   ‚îú‚îÄ‚îÄ dev/compose.yml             # Docker config
‚îÇ   ‚îî‚îÄ‚îÄ shared/db/                  # SQL initialization files
‚îú‚îÄ‚îÄ docs/                           # ‚ùå Dev only (not deployed)
‚îú‚îÄ‚îÄ config/                         # ‚ùå Dev only (not deployed)
‚îî‚îÄ‚îÄ tmp/                            # ‚ùå Dev only (not deployed)
```

**What Hostinger Deploys:**
- ‚úÖ `wp-content/` directory (themes, plugins, mu-plugins)
- ‚ùå Everything else is excluded via [.hostingerignore](../.hostingerignore)

**What Hostinger Provides:**
- WordPress core files (`wp-admin/`, `wp-includes/`, `index.php`)
- `wp-config.php` with database credentials
- `.htaccess` generated by WordPress

### Step 3: Import Initial Database

‚ö†Ô∏è **Hostinger Git integration does NOT automatically import SQL files** - this is a manual process.

#### Export from Development

```powershell
cd infra/dev
podman exec -it wp-db mysqldump -u root -ppassword wordpress | `
  Out-File -Encoding utf8 ..\..\tmp\initial-production-export.sql
```

#### Prepare SQL for Production

1. Open `tmp/initial-production-export.sql` in text editor

2. **Find/Replace URLs:**
   - Find: `http://localhost:8080`
   - Replace: `https://yourdomain.com`

3. **Find/Replace file paths (if needed):**
   - Find: `/var/www/html/wp-content`
   - Replace: `/home/u123456789/public_html/wp-content` (check your Hostinger path)

4. Save changes

#### Import to Hostinger

1. **Access phpMyAdmin:**
   - Hostinger hPanel ‚Üí Databases ‚Üí Manage ‚Üí phpMyAdmin
   - Or direct link: https://phpmyadmin.hostinger.com

2. **Select Database:**
   - Left sidebar ‚Üí Click your WordPress database name
   - Usually: `u123456789_wordpress`

3. **Import SQL:**
   - Top menu ‚Üí "Import" tab
   - Click "Choose File" ‚Üí Select `initial-production-export.sql`
   - Format: Auto-detect (or select "SQL")
   - Click "Go" at bottom

4. **Wait for Import:**
   - Large databases may take several minutes
   - You'll see "Import has been successfully finished" when done

5. **Verify Site:**
   - Browse to `https://yourdomain.com`
   - Log in to `/wp-admin` with your credentials

---

## Daily Development Workflow

### Making Code Changes (Themes/Plugins)

1. **Start local environment:**
   ```powershell
   cd infra/dev
   podman-compose up -d
   ```

2. **Make changes:**
   - Edit files in `wp-content/themes/your-theme/`
   - Or `wp-content/plugins/your-plugin/`

3. **Test locally:**
   - Browse http://localhost:8080
   - Verify functionality works

4. **Commit and push:**
   ```powershell
   git add wp-content/themes/your-theme/
   git commit -m "feat: added new homepage section"
   git push origin main
   ```

5. **Auto-deployment happens:**
   - Hostinger detects push to `main`
   - Deploys changes to `public_html/wp-content/`
   - Usually completes in 10-30 seconds

6. **Monitor deployment:**
   - Hostinger hPanel ‚Üí Git ‚Üí View deployment log
   - Check for "Deployment successful" message

7. **Verify on production:**
   - Browse https://yourdomain.com
   - Hard refresh browser (Ctrl+F5) to clear cache
   - Test the changes

### Making Database Changes

#### Current Process (Manual)

When you make database changes locally (new tables, schema modifications, config changes):

1. **Export structural changes:**
   ```powershell
   cd infra/dev
   podman exec -it wp-db mysqldump -u root -ppassword --no-data wordpress | `
     Out-File -Encoding utf8 ..\..\infra\shared\db\$(Get-Date -Format 'yyMMdd')-your-change-description.sql
   ```

2. **Or export specific tables/data:**
   ```powershell
   # Example: Export WooCommerce settings
   podman exec -it wp-db mysqldump -u root -ppassword wordpress `
     --tables wp_options `
     --where="option_name LIKE 'woocommerce_%'" | `
     Out-File -Encoding utf8 ..\..\tmp\$(Get-Date -Format 'yyMMdd')-woo-settings.sql
   ```

3. **Prepare SQL for production:**
   - Update URLs and paths as needed
   - Test import locally first

4. **Import to Hostinger:**
   - hPanel ‚Üí Databases ‚Üí phpMyAdmin
   - Select database ‚Üí Import tab
   - Upload your SQL file
   - Execute import

#### üöß Future Enhancement

See [OPEN-ACTIONS.md](OPEN-ACTIONS.md) for automated database migration tasks.

**Status:** Not yet implemented - document and track as technical debt

**Reference:** See [docs/DATABASE.md](DATABASE.md) for SQL file conventions

---

## File Management

### What to Track in Git

**Always track (committed to repository):**
- ‚úÖ Custom themes: `wp-content/themes/your-theme/`
- ‚úÖ Custom plugins: `wp-content/plugins/your-plugin/`
- ‚úÖ Must-use plugins: `wp-content/mu-plugins/`
- ‚úÖ `.gitignore` and `.hostingerignore`

**Optional (your choice):**
- üü° Third-party plugins (WooCommerce, Elementor, etc.)
  - **Pros:** Version controlled, consistent across environments
  - **Cons:** Large repo size, security updates require manual commits
  - **Recommendation:** Track if you modify them, otherwise install via WordPress admin

- üü° Default themes (twentytwenty*, etc.)
  - **Recommendation:** Usually exclude, activate via WordPress admin instead

**Never track:**
- ‚ùå Uploads: `wp-content/uploads/` (too large, user-generated)
- ‚ùå WordPress core: `wp-admin/`, `wp-includes/` (Hostinger manages)
- ‚ùå Config files: `wp-config.php` (server-specific secrets)
- ‚ùå Dev infrastructure: `infra/`, `docs/`, `.github/`, `tmp/`, `config/`

### Managing Uploads

Uploads directory (`wp-content/uploads/`) grows large and shouldn't be in Git.

**Options for syncing uploads between dev and prod:**

**Option 1: Periodic download from Hostinger**
```powershell
# Using SFTP/FTP client (FileZilla, WinSCP)
# Download: public_html/wp-content/uploads/ ‚Üí local/wp-content/uploads/
```

**Option 2: Use plugin (recommended)**
- Install "WP Migrate Lite" or "All-in-One WP Migration"
- Pull media from production to development
- Exclude from Git, sync only when needed

**Option 3: Cloud storage**
- Use "WP Offload Media" plugin
- Store uploads in AWS S3, DigitalOcean Spaces, or similar
- Both dev and prod read from same cloud storage

---

## Hostinger-Specific Optimizations

### Enable LiteSpeed Cache

Hostinger uses LiteSpeed web servers (faster than Apache):

1. **Install LiteSpeed Cache plugin:**
   - WordPress Admin ‚Üí Plugins ‚Üí Add New
   - Search "LiteSpeed Cache"
   - Install and Activate

2. **Configure:**
   - LiteSpeed Cache ‚Üí Dashboard ‚Üí Click "Apply" on recommended settings
   - Enable: Page Cache, Browser Cache, Object Cache
   - Enable: Image Optimization (uses Hostinger's built-in optimization)

3. **Clear cache after deployments:**
   - LiteSpeed Cache ‚Üí Dashboard ‚Üí Purge All

### Configure Hostinger CDN

1. **Enable in hPanel:**
   - Websites ‚Üí Select site ‚Üí Performance ‚Üí CDN
   - Toggle "Enable Hostinger CDN"

2. **Configure in WordPress:**
   - Some themes/plugins may need CDN URL configuration
   - Usually auto-detected

### Increase PHP Limits

1. **Access PHP Configuration:**
   - hPanel ‚Üí Advanced ‚Üí PHP Configuration
   - Or: File Manager ‚Üí Select PHP Options

2. **Update limits:**
   ```ini
   upload_max_filesize = 64M
   post_max_size = 128M
   max_execution_time = 600
   memory_limit = 256M
   max_input_vars = 3000
   ```

3. **Save changes** (may require waiting 1-2 minutes to take effect)

### SSL/HTTPS Configuration

1. **Enable SSL (if not already):**
   - hPanel ‚Üí SSL ‚Üí Select domain ‚Üí Install SSL
   - Hostinger provides free Let's Encrypt certificates

2. **Force HTTPS:**
   - WordPress Admin ‚Üí Settings ‚Üí General
   - Update both URLs to `https://yourdomain.com`
   - Or add to `wp-config.php`:
     ```php
     define('FORCE_SSL_ADMIN', true);
     if ($_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https') {
         $_SERVER['HTTPS'] = 'on';
     }
     ```

### Automated Backups

1. **Enable Hostinger backups:**
   - hPanel ‚Üí Backups ‚Üí Configure schedule
   - Recommendation: Daily backups, 7-day retention minimum

2. **Manual backup before major changes:**
   - hPanel ‚Üí Backups ‚Üí Create Backup
   - Download backup locally for safekeeping

3. **Plugin-based backups (optional):**
   - Install "UpdraftPlus" or "BackWPup"
   - Configure offsite storage (Dropbox, Google Drive, S3)

---

## Troubleshooting

### Deployment Not Triggering

**Symptoms:** Pushed to `main`, no deployment happens

**Solutions:**
1. Check deployment settings:
   - hPanel ‚Üí Git ‚Üí Verify auto-deploy is enabled
   - Verify branch is `main` (not `master`)

2. Check deployment logs:
   - hPanel ‚Üí Git ‚Üí View deployment history
   - Look for error messages

3. Manual deployment:
   - hPanel ‚Üí Git ‚Üí Click "Deploy Now"

### Files Not Appearing on Hostinger

**Symptoms:** Pushed files don't show up in `public_html/`

**Causes:**
1. Files excluded by `.hostingerignore`
2. Deployment path misconfigured

**Solutions:**
1. Check `.hostingerignore` - ensure files aren't excluded
2. Verify deployment path is `public_html`
3. Check file permissions after deployment

### White Screen of Death (WSOD)

**Symptoms:** Site shows blank white screen

**Causes:** PHP error, memory limit, plugin conflict

**Solutions:**
1. Enable debug mode:
   - Edit `wp-config.php` via File Manager:
     ```php
     define('WP_DEBUG', true);
     define('WP_DEBUG_LOG', true);
     define('WP_DEBUG_DISPLAY', false);
     ```
   - Check `wp-content/debug.log` for errors

2. Disable plugins:
   - File Manager ‚Üí Rename `wp-content/plugins` to `wp-content/plugins-disabled`
   - Access site, re-enable plugins one by one

3. Increase PHP memory:
   - hPanel ‚Üí PHP Configuration ‚Üí `memory_limit = 256M`

### Database Connection Error

**Symptoms:** "Error establishing database connection"

**Causes:** Wrong credentials, database server down

**Solutions:**
1. Verify credentials in `wp-config.php`:
   - File Manager ‚Üí `public_html/wp-config.php`
   - Check `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_HOST`
   - Compare with hPanel ‚Üí Databases credentials

2. Check database exists:
   - hPanel ‚Üí Databases ‚Üí Verify database is listed

3. Contact Hostinger support if database server is down

### Mixed Content Warnings (HTTP/HTTPS)

**Symptoms:** Browser shows "Not Secure" despite SSL certificate

**Causes:** Some URLs reference HTTP instead of HTTPS

**Solutions:**
1. Update site URLs:
   - WordPress Admin ‚Üí Settings ‚Üí General
   - Ensure both URLs use `https://`

2. Search/replace in database:
   - Install "Better Search Replace" plugin
   - Search: `http://yourdomain.com`
   - Replace: `https://yourdomain.com`
   - Run on all tables

3. Force HTTPS in `.htaccess`:
   ```apache
   RewriteEngine On
   RewriteCond %{HTTPS} off
   RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
   ```

---

## Best Practices

### Development Workflow

1. ‚úÖ Always test locally before pushing
2. ‚úÖ Commit frequently with descriptive messages
3. ‚úÖ Use feature branches for large changes
4. ‚úÖ Merge to `main` only after testing
5. ‚úÖ Monitor deployment logs after push
6. ‚úÖ Keep development and production plugin versions in sync

### Database Management

1. ‚úÖ Export database changes to SQL files in `infra/shared/db/`
2. ‚úÖ Test SQL imports locally before applying to production
3. ‚úÖ Backup production database before major schema changes
4. ‚úÖ Use descriptive filenames: `251225-add-loyalty-tables.sql`
5. ‚úÖ Document purpose in SQL file header comments

### Security

1. ‚úÖ Never commit `wp-config.php` or database credentials
2. ‚úÖ Keep `.hostingerignore` and `.gitignore` updated
3. ‚úÖ Use strong passwords for WordPress admin accounts
4. ‚úÖ Enable two-factor authentication
5. ‚úÖ Regularly update plugins/themes (test in dev first)
6. ‚úÖ Review Hostinger security scanner reports

### Performance

1. ‚úÖ Enable LiteSpeed Cache
2. ‚úÖ Optimize images before upload
3. ‚úÖ Use Hostinger CDN for static assets
4. ‚úÖ Minimize plugins (remove unused)
5. ‚úÖ Monitor disk space and database size

---

## Rollback Procedures

### Git Rollback (Revert Code Changes)

```powershell
# View recent commits
git log --oneline -10

# Revert to previous commit
git revert HEAD
git push origin main

# Or reset to specific commit (careful - rewrites history)
git reset --hard abc1234
git push origin main --force
```

### Database Rollback (Restore from Backup)

1. **Download backup:**
   - hPanel ‚Üí Backups ‚Üí Select backup date
   - Download database backup file

2. **Import via phpMyAdmin:**
   - phpMyAdmin ‚Üí Select database
   - Import tab ‚Üí Choose backup file
   - Execute import

3. **Verify site functionality**

---

## Additional Resources

- [docs/DATABASE.md](DATABASE.md) - Database management and SQL workflows
- [docs/SECURITY.md](SECURITY.md) - Security scanning and hardening
- [.hostingerignore](../.hostingerignore) - Deployment exclusion rules
- [.gitignore](../.gitignore) - Git tracking rules
- [infra/shared/db/README.md](../infra/shared/db/README.md) - SQL file conventions
- Hostinger Documentation: https://support.hostinger.com/en/articles/6857923-how-to-use-git-deployment
- Hostinger Support: https://support.hostinger.com

---

## See Also

- [OPEN-ACTIONS.md](OPEN-ACTIONS.md) - All open action items and future enhancements

**Estimated Effort:** 2-4 hours

**Priority:** Medium (manual process works but is tedious)

### üöß Uploads Synchronization Strategy

**Current State:** Manual download of uploads via SFTP when needed

**Future Options:**
- [ ] Evaluate cloud storage plugins (S3, Spaces)
- [ ] Set up automated backup/sync script
- [ ] Document chosen approach

**Priority:** Low (current manual process acceptable for small teams)
