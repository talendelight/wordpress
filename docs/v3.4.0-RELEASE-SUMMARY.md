# v3.4.0 Release Summary

**Date:** January 19, 2026  
**Status:** In Development  

---

## What's New

### 1. Manager Admin Operations Page
- **URL:** `/manager-admin/`
- **Tabbed Interface:** 4 tabs (Submitted, Approved, Rejected, All)
- **Real-time Actions:** Approve (✓), Reject (✗), Undo (↶)
- **Role-based Display:** Shows role badges (Candidate, Employer, Scout, Operator, Manager)
- **Profile Methods:** Supports both LinkedIn + CV display
- **Database Integration:** Live data from `td_user_data_change_requests` table

### 2. Generic Audit Logging System
- **Table:** `td_audit_log`
- **Tracks:** All database changes (insert, update, delete, approve, reject, undo)
- **Records:** User ID, timestamp, IP address, user agent, old/new values
- **Purpose:** Compliance, security, troubleshooting

### 3. Enhanced User Requests Schema
- **New Columns:**
  - `role` - User role (candidate, employer, scout, operator, manager)
  - `has_linkedin` - Boolean flag for LinkedIn profile
  - `has_cv` - Boolean flag for CV upload
- **Supports:** Multiple profile methods per request

---

## Files Changed

### Database Migrations
1. `infra/shared/db/260117-impl-add-td_user_data_change_requests.sql` - Base table
2. `infra/shared/db/260119-1400-add-role-and-audit-log.sql` - Role & audit log

### mu-plugins (Auto-loaded)
1. `wp-content/mu-plugins/user-requests-display.php` - Shortcode and AJAX handlers
2. `wp-content/mu-plugins/audit-logger.php` - Audit logging helper class

### Elementor Pages
1. `managers` (ID 333) - Managers Dashboard (backlog from v3.3.0)
2. `manager-admin` (ID 386) - New Manager Admin Operations page

### Documentation
1. `docs/RELEASE-NOTES-NEXT.md` - Human-readable deployment steps
2. `.github/releases/v3.4.0.json` - Machine-readable deployment manifest
3. `docs/MANAGER-ADMIN-TABS-IMPLEMENTATION.md` - Implementation guide
4. `docs/features/WP-01.6-user-request-approvals.md` - Feature specification

---

## Technical Implementation

### Shortcode Usage
```php
[user_requests_table status="pending"]
[user_requests_table status="approved" days="90"]
[user_requests_table status="rejected" days="90"]
[user_requests_table status="all" days="90"]
```

### AJAX Actions
```javascript
wp_ajax_td_approve_request   // Approve pending request
wp_ajax_td_reject_request    // Reject pending request
wp_ajax_td_undo_reject       // Undo rejected request
```

### Audit Logging
```php
TD_Audit_Logger::log(
    $table_name,    // 'td_user_data_change_requests'
    $record_id,     // Request ID
    $action,        // 'approve', 'reject', 'undo'
    $old_value,     // Previous status
    $new_value,     // New status
    $column_name,   // 'status'
    $notes          // Optional context
);
```

---

## Testing Checklist

### Local Testing
- [x] Database migrations applied
- [x] Sample data inserted
- [x] Tabs render correctly
- [x] Approve action works
- [x] Reject action works
- [x] Undo action works
- [x] Audit log entries created
- [x] Role badges display
- [x] Profile methods show correctly

### Production Testing (Post-Deployment)
- [ ] Pages deployed successfully
- [ ] Database migrations applied
- [ ] mu-plugins loaded
- [ ] AJAX endpoints working
- [ ] Access control verified (Manager/Admin only)
- [ ] Audit log capturing changes
- [ ] No console errors
- [ ] Mobile responsive

---

## Rollback Plan

If issues occur after deployment:

1. **Revert code:**
   ```bash
   git revert <commit-hash>
   git push origin main
   ```

2. **Rollback database (if needed):**
   ```bash
   wp db query "DROP TABLE IF EXISTS td_audit_log;"
   wp db query "ALTER TABLE td_user_data_change_requests DROP COLUMN role, DROP COLUMN has_linkedin, DROP COLUMN has_cv;"
   ```

3. **Disable mu-plugins:**
   ```bash
   mv wp-content/mu-plugins/user-requests-display.php wp-content/mu-plugins/user-requests-display.php.disabled
   mv wp-content/mu-plugins/audit-logger.php wp-content/mu-plugins/audit-logger.php.disabled
   ```

---

## Next Steps (Future Releases)

### v3.5.0 (Planned)
- Full detail view modal for requests
- Bulk approve/reject actions
- Advanced filtering (by role, date range, type)
- Email notifications for status changes
- Export to CSV functionality

### v3.6.0 (Planned)
- User Management section (tile #2)
- System Settings section (tile #3)
- Role Management section (tile #5)

---

## References

- [Feature Spec: WP-01.6](docs/features/WP-01.6-user-request-approvals.md)
- [Implementation Guide](docs/MANAGER-ADMIN-TABS-IMPLEMENTATION.md)
- [Release Process](docs/RELEASE-NOTES-PROCESS.md)
- [Deployment Workflow](docs/DEPLOYMENT-WORKFLOW.md)
