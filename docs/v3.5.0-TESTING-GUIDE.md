# v3.5.0 Production Testing Guide

**Release Date:** January 26, 2026  
**Production URL:** https://talendelight.com

---

## Pre-Testing Checklist

- [ ] Confirm deployment completed successfully (GitHub Actions status: ✅)
- [ ] Have SSH access: `ssh -i tmp/hostinger_deploy_key -p 65002 u909075950@45.84.205.129`
- [ ] Have production login credentials ready
- [ ] Open browser in incognito/private mode for testing

---

## Test 1: Environment Configuration (td-env-config.php)

### Purpose
Verify environment-specific constants are loaded automatically via mu-plugin.

### Steps

1. **SSH into production:**
   ```bash
   ssh -i tmp/hostinger_deploy_key -p 65002 u909075950@45.84.205.129
   ```

2. **Verify mu-plugin exists:**
   ```bash
   ls -lh /home/u909075950/domains/talendelight.com/public_html/wp-content/mu-plugins/td-env-config.php
   ```
   **Expected:** File exists with ~2.3KB size

3. **Check if constants are defined:**
   ```bash
   wp eval 'echo "TD_ENVIRONMENT: " . (defined("TD_ENVIRONMENT") ? TD_ENVIRONMENT : "NOT DEFINED") . "\n";' --path=/home/u909075950/domains/talendelight.com/public_html
   ```
   **Expected:** `TD_ENVIRONMENT: production`

4. **Verify form ID constant:**
   ```bash
   wp eval 'echo "TD_PERSON_REGISTRATION_FORM_ID: " . (defined("TD_PERSON_REGISTRATION_FORM_ID") ? TD_PERSON_REGISTRATION_FORM_ID : "NOT DEFINED") . "\n";' --path=/home/u909075950/domains/talendelight.com/public_html
   ```
   **Expected:** `TD_PERSON_REGISTRATION_FORM_ID: 80` (production form ID)

5. **Verify page ID constants:**
   ```bash
   wp eval 'echo "TD_WELCOME_PAGE_ID: " . (defined("TD_WELCOME_PAGE_ID") ? TD_WELCOME_PAGE_ID : "NOT DEFINED") . "\n"; echo "TD_SELECT_ROLE_PAGE_ID: " . (defined("TD_SELECT_ROLE_PAGE_ID") ? TD_SELECT_ROLE_PAGE_ID : "NOT DEFINED") . "\n";' --path=/home/u909075950/domains/talendelight.com/public_html
   ```
   **Expected:**
   - `TD_WELCOME_PAGE_ID: 14`
   - `TD_SELECT_ROLE_PAGE_ID: 78`

### Success Criteria
- ✅ File exists in mu-plugins directory
- ✅ All constants are defined with production values
- ✅ No PHP errors in debug.log

---

## Test 2: Forminator Upload Handler Plugin

### Purpose
Verify custom upload handler is active and configured correctly.

### Steps

1. **Check plugin status via SSH:**
   ```bash
   wp plugin list --path=/home/u909075950/domains/talendelight.com/public_html | grep forminator
   ```
   **Expected:**
   - `forminator` - active, 1.49.2
   - `forminator-upload-handler` - active, 1.0

2. **Verify plugin files exist:**
   ```bash
   ls -lh /home/u909075950/domains/talendelight.com/public_html/wp-content/plugins/forminator-upload-handler/
   ```
   **Expected:** 
   - `forminator-upload-handler.php` (~4KB)
   - `README.md`

3. **Check if target directory exists:**
   ```bash
   ls -ld /home/u909075950/domains/talendelight.com/public_html/wp-content/uploads/people/
   ```
   **Expected:** Directory exists with write permissions
   **If not exists:**
   ```bash
   mkdir -p /home/u909075950/domains/talendelight.com/public_html/wp-content/uploads/people/
   chmod 755 /home/u909075950/domains/talendelight.com/public_html/wp-content/uploads/people/
   ```

4. **Test form submission (Browser Test):**
   - Navigate to: https://talendelight.com/person-registration/ (or wherever form ID 80 is embedded)
   - Fill out the form
   - **Upload a test CV file** (e.g., test-cv.pdf)
   - Submit form

5. **Verify file was moved to correct directory:**
   ```bash
   ls -lh /home/u909075950/domains/talendelight.com/public_html/wp-content/uploads/people/
   ```
   **Expected:** Your uploaded file appears with timestamp-based name

6. **Check upload handler logs:**
   ```bash
   tail -50 /home/u909075950/domains/talendelight.com/public_html/wp-content/debug.log | grep "Forminator Upload Handler"
   ```
   **Expected:** Log entries showing file processing:
   ```
   [Forminator Upload Handler] Processing form_id 80, entry_id XXX
   [Forminator Upload Handler] File moved successfully to /uploads/people/test-cv-20260126-123456.pdf
   ```

### Success Criteria
- ✅ Plugin is active
- ✅ Target directory exists with correct permissions
- ✅ Test upload moves file to `/uploads/people/` directory
- ✅ No errors in debug.log

---

## Test 3: PENG-053 - wp-admin Blocking

### Purpose
Verify non-Administrator roles are blocked from accessing WordPress admin panel.

### Steps

1. **Test Administrator Access (Baseline):**
   - Login as Administrator (username: `admin` or equivalent)
   - Navigate to: https://talendelight.com/wp-admin/
   - **Expected:** ✅ Full access to dashboard

2. **Test Manager Role (Blocked):**
   - Logout
   - Login as Manager user (check [docs/TEST-USERS.md](TEST-USERS.md) for credentials)
   - Navigate to: https://talendelight.com/wp-admin/
   - **Expected:** 
     - ❌ Redirected to `/managers/?access_denied=wp-admin`
     - Yellow notice: "Access Denied: You don't have permission to access the admin area"
     - No admin bar visible at top of page

3. **Test Operator Role (Blocked):**
   - Logout
   - Login as Operator user
   - Navigate to: https://talendelight.com/wp-admin/
   - **Expected:**
     - ❌ Redirected to `/operators/?access_denied=wp-admin`
     - Yellow notice displayed
     - No admin bar visible

4. **Test External Roles (Blocked):**
   - Repeat for Candidate, Employer, Scout roles
   - **Expected:** All blocked with appropriate redirects

5. **Verify Security Logging (SSH):**
   ```bash
   grep "TalenDelight Security: Blocked wp-admin access" /home/u909075950/domains/talendelight.com/public_html/wp-content/debug.log | tail -10
   ```
   **Expected:** Log entries for each blocked access attempt:
   ```
   TalenDelight Security: Blocked wp-admin access for user manager_user (ID: 123, Roles: td_manager)
   ```

6. **Test AJAX Still Works (Advanced):**
   - Login as Manager
   - Go to any page with AJAX functionality (e.g., form submission)
   - Submit form or trigger AJAX action
   - **Expected:** ✅ AJAX requests work (not blocked by wp-admin filter)

### Success Criteria
- ✅ Administrator has full wp-admin access
- ✅ All non-Administrator roles are blocked
- ✅ Proper redirects to role-specific landing pages
- ✅ Admin bar hidden for non-Administrators
- ✅ Security logs show blocked access attempts
- ✅ AJAX functionality unaffected

---

## Test 4: Combined Integration Test

### Purpose
Verify all components work together in real-world scenario.

### Test Scenario: New Candidate Registration

1. **Open incognito browser window**
2. **Navigate to registration page** (person-registration form)
3. **Fill out form with test data:**
   - First Name: Test
   - Last Name: Candidate
   - Email: test.candidate.v350@example.com
   - Upload CV: test-resume.pdf
4. **Submit form**

5. **Verify via SSH:**

   **a) Check user was created:**
   ```bash
   wp user list --path=/home/u909075950/domains/talendelight.com/public_html --search="test.candidate.v350@example.com"
   ```

   **b) Check CV was uploaded to correct directory:**
   ```bash
   ls -lh /home/u909075950/domains/talendelight.com/public_html/wp-content/uploads/people/ | grep test-resume
   ```

   **c) Verify environment detected correctly:**
   ```bash
   wp eval 'echo "Form ID used: " . TD_PERSON_REGISTRATION_FORM_ID . "\n";' --path=/home/u909075950/domains/talendelight.com/public_html
   ```

6. **Login as new user and try to access wp-admin:**
   - Login with test.candidate.v350@example.com
   - Navigate to https://talendelight.com/wp-admin/
   - **Expected:** Blocked and redirected

### Success Criteria
- ✅ Form submission succeeds
- ✅ User created with correct role
- ✅ CV uploaded to `/uploads/people/`
- ✅ Environment config used production form ID (80)
- ✅ New user blocked from wp-admin

---

## Rollback Procedure (If Issues Found)

If critical issues are discovered during testing:

1. **Immediate Rollback:**
   ```bash
   cd /home/u909075950/domains/talendelight.com/public_html/wp-content/plugins/talendelight-roles
   
   # Restore v1.0.0 backup
   cp ~/backup-talendelight-roles-20260125.php talendelight-roles.php
   ```

2. **Deactivate New Plugins:**
   ```bash
   wp plugin deactivate forminator-upload-handler --path=/home/u909075950/domains/talendelight.com/public_html
   ```

3. **Remove MU-Plugin (if causing issues):**
   ```bash
   mv /home/u909075950/domains/talendelight.com/public_html/wp-content/mu-plugins/td-env-config.php ~/td-env-config.php.disabled
   ```

4. **Clear All Caches:**
   ```bash
   wp cache flush --path=/home/u909075950/domains/talendelight.com/public_html
   ```

5. **Notify Development Team**

---

## Post-Testing Actions

After all tests pass:

1. **Update release status:**
   - [ ] Mark v3.5.0 as "verified" in release notes
   - [ ] Close GitHub issue #63 (PENG-053)

2. **Archive release files:**
   ```bash
   cd c:\data\lochness\talendelight\code\wordpress
   
   # Archive v3.5.0.json
   Move-Item .github/releases/v3.5.0.json .github/releases/archive/v3.5.0.json
   
   # Commit archive
   git add .github/releases/archive/v3.5.0.json
   git commit -m "Archive v3.5.0 after successful production verification"
   git push origin develop
   ```

3. **Prepare v3.6.0:**
   ```bash
   # Copy template for next release
   Copy-Item .github/releases/archive/v3.5.0.json .github/releases/v3.6.0.json
   # Edit v3.6.0.json: Update version, clear features array, reset status to "planned"
   ```

4. **Update session summary** with testing results

---

## Notes

- All SSH commands use absolute path to avoid WP-CLI detection issues
- Test users are documented in [docs/TEST-USERS.md](TEST-USERS.md)
- Production form IDs are documented in [docs/PENG-001-CANDIDATEID-STRATEGY.md](PENG-001-CANDIDATEID-STRATEGY.md)
- For issues, check `/wp-content/debug.log` first

---

## Testing Sign-off

**Tested By:** ________________  
**Date:** ________________  
**All Tests Passed:** ☐ Yes ☐ No (see issues below)

**Issues Found:**
```
(List any issues discovered during testing)
```
