services:

  wp:
    build:
      context: .
      dockerfile: Dockerfile
    image: wordpress-wpcli:6.9.0-php8.3-apache
    container_name: wp
    volumes:
      - ../../config/wp-config.php:/var/www/html/wp-config.php
      - ../../config/.htaccess:/var/www/html/.htaccess
      - ../../wp-content:/var/www/html/wp-content:rw
      - ../../config/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini
    environment:
      - WORDPRESS_DB_NAME=wordpress
      - WORDPRESS_TABLE_PREFIX=wp_
      - WORDPRESS_DB_HOST=wp-db
      - WORDPRESS_DB_USER=root
      - WORDPRESS_DB_PASSWORD=password
      - WORDPRESS_DEBUG=1
      # - WORDPRESS_DB_ADMIN_PASSWORD=dba-password
      # - WORDPRESS_ADMIN_NAME=WpAdminFirstName
      # - WORDPRESS_ADMIN_LASTNAME=WpAdminLastName
      # - WORDPRESS_ADMIN_USERNAME=wp-admin
      # - WORDPRESS_ADMIN_PASSWORD=wp-admin-password
      # - WORDPRESS_ADMIN_EMAIL=admin@yourdomain.com
      # - WORDPRESS_HOSTNAME=wordpress.yourdomain.com
      # - WORDPRESS_SMTP_ADDRESS=smtp.your-email-provider.com
      # - WORDPRESS_SMTP_PORT=587
      # - WORDPRESS_SMTP_USER_NAME=your-smtp-username
      # - WORDPRESS_SMTP_PASSWORD=your-smtp-password
      # Optional
      # - WORDPRESS_MARIADB_IMAGE_TAG=mariadb:11.4
      # - WORDPRESS_IMAGE_TAG=bitnami/wordpress:6.6.2
    working_dir: /var/www/html
    depends_on:
      - wp-db
      - phpmyadmin
    restart: always
    ports:
      - 8080:80
      # - 8443:443

  wp-db:
    image: mariadb:11.8.3-noble
    container_name: wp-db
    volumes:
      - db-data:/var/lib/mysql
      # Imports on every fresh start (when volume is empty/destroyed)
      # Baseline schema and all structural changes imported in alphabetical order
      - ../shared/db:/docker-entrypoint-initdb.d
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_USER=root
      - MYSQL_PASSWORD=password
      - MYSQL_DATABASE=wordpress
    restart: always
    ports:
      - "3306:3306"

  phpmyadmin:
    depends_on:
      - wp-db
    image: phpmyadmin:5.2.2-apache
    container_name: phpmyadmin
    restart: always
    ports:
      - 8180:80
    environment:
      PMA_HOST: wp-db
      MYSQL_ROOT_PASSWORD: password

  caddy:
    image: caddy:2
    container_name: caddy
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ./certs:/etc/caddy/certs:ro
    depends_on:
      - wp

volumes:
  db-data:
  wp-data: